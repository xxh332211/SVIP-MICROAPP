<!--pages-xmb/pages/xmbCenter/xmbCenter.wxml-->
<privacy-popup></privacy-popup>
<view class="container" bindtouchmove="onTouchMove">
  <view class="banner-bg"></view>

  <view class="xmb-rules" bindtap="toRules">
    <image style="width: 32rpx;height: 32rpx;margin-right: 10rpx;"
      src="https://img.51jiabo.com/637df690-dfed-4ee6-8f42-a560eba84466.png"></image>
    <text>规则说明</text>
  </view>

  <view class="num-title" bindtap="toXmbDetail">
    <image style="width: 34rpx;height: 34rpx;transform: translateY(6rpx);"
      src="https://img.51jiabo.com/f32e2be7-daab-4929-ac09-a6d50d8beeb8.png"></image>
    <text class="num">{{totCoin}}</text>
    <image style="width: 12rpx;height: 24rpx;" src="https://img.51jiabo.com/21d51283-62eb-45ed-9fbf-e7a4c350282b.png">
    </image>
  </view>

  <!-- 签到 -->
  <view class="sign-in" wx:if="{{taskList[0].config_id == 1}}">
    <view class="sign-in-title">
      <view>已连续签到<text style="color: #E6002D;">{{taskList[0].check_times}}</text>天</view>
      <image wx:if="{{taskList && taskList[0].rule}}" style="width: 32rpx;height: 32rpx;" src="https://img.51jiabo.com/4748606e-4600-46f4-a0c8-3e22363be450.png" bindtap="signInRulesShow" data-rule="{{taskList[0].rule}}">
      </image>
    </view>
    <view class="sign-in-progress">
      <view wx:for="{{taskList[0].check_list}}" wx:key="index" class="pro-item pro-item-active">
        <image style="width: 20rpx;height: 20rpx;"
          src="https://img.51jiabo.com/e1984023-a9fc-4822-9328-bb01b509d330.png"></image>
        <view>+{{item.coin_num}}</view>
      </view>
      <view wx:for="{{taskList[0].check_list.length ? 7-taskList[0].check_list.length : 7}}" wx:key="index" class="pro-item">
        <image style="width: 20rpx;height: 20rpx;"
          src="https://img.51jiabo.com/98debfde-2ebd-442a-b865-179dc0427235.png"></image>
        <view>+{{taskList[0].get_coin_num}}</view>
      </view>
      <view class="pro-line"></view>
    </view>
    <view class="sign-in-tips">每日签到可获得{{taskList[0].get_coin_num}}熊猫币</view>
  </view>

  <!-- 运营位 -->
  <swiper class="banner" wx:if="{{xmbAdv && xmbAdv.length}}" circular="true" autoplay="true">
    <swiper-item wx:for="{{xmbAdv}}" wx:key="index">
      <image mode="widthFix" style="width: 100%;margin:30rpx 0;" src="{{item.wap_image_url}}" data-item="{{xmbAdv[xmbAdv.length-1]}}" bindtap="swiperUrl"></image>
    </swiper-item>
  </swiper>

  <!-- 任务 -->
  <view wx:if="{{taskList && taskList.length}}" class="task">
    <view class="task-title">做任务赚熊猫币</view>
    <view class="task-item" wx:for="{{taskList}}" wx:key="config_id">
      <view class="task-main">
        <image style="width: 70rpx;height: 70rpx;" src="{{item.icon_url}}"></image>
        <view class="task-cont">
          <view>
            <text class="task-cont-tit">{{item.name}}</text>
            <text wx:if="{{item.give_coin_total}}" class="task-cont-pro">已获得{{item.user_get}}/{{item.give_coin_total}}</text>
          </view>
          <view class="task-cont-desc">
            <block wx:if="{{item.get_coin_num}}">
              <image style="width: 34rpx;height: 35rpx;"
                src="https://img.51jiabo.com/983e9af2-b384-4f5d-930c-d56f788699d9.png"></image>
              <view style="margin: 0 10rpx;">
                <text style="color: #E6002D;font-weight: bold;">+{{item.get_coin_num}}</text>熊猫币
              </view>
            </block>
            <image wx:if="{{item.rule}}" style="width: 28rpx;height: 28rpx;"
              src="https://img.51jiabo.com/4748606e-4600-46f4-a0c8-3e22363be450.png" bindtap="xmbRulesShow" data-id="{{item.config_id}}" data-rule="{{item.rule}}"></image>
          </view>
        </view>
      </view>

      <view class="task-status">
        <button open-type="{{item.config_id == 4 ? 'share' : ''}}" wx:if="{{item.status == 1}}" class="task-status-btn" bindtap="doTask" data-id="{{item.config_id}}" data-popup="{{item.alert_text}}">做任务</button>
        <view wx:elif="{{item.status == 101}}" class="task-status-btn" style="background-color: #FF8525;" bindtap="getXmbHandle" data-id="{{item.config_id}}">领取熊猫币</view>
        <image wx:elif="{{item.status == 100}}" style="width: 80rpx;height: 80rpx;" src="https://img.51jiabo.com/4526a17b-ace9-474b-957a-83f24d889bc4.png"></image>
      </view>
    </view>
  </view>

  <!-- 抽奖/兑换 -->
  <view class="xmb-use" wx:if="{{(lotteryLoopList && lotteryLoopList.prize.length) || siteActivityList}}">
    <lottery-loop wx:if="{{lotteryLoopList && lotteryLoopList.prize.length}}" lotteryLoopList="{{lotteryLoopList}}" origin="xmbCenter"></lottery-loop>

    <!-- 展会现场活动 -->
    <view class="activity" wx:if="{{siteActivityList}}">
      <view class="activity-title">展会现场活动</view>
      <view class="activity-list">
        <view class="activity-item" wx:for="{{siteActivityList}}" wx:key="id">
          <image style="width: 128rpx;height: 107rpx;" src="{{item.image_url}}"></image>
          <view class="activity-name">{{item.name}}</view>
          <view class="activity-cont">
            <view class="activity-num">{{item.panda_coin}}/币</view>
            <view class="activity-rules" bindtap="activityRulesShow" data-rule="{{item.rule}}">
              <image style="width: 28rpx;height: 28rpx;margin-right: 5rpx;"
                src="https://img.51jiabo.com/4748606e-4600-46f4-a0c8-3e22363be450.png"></image>
              <text>规则</text>
            </view>
          </view>
          <button class="activity-btn" bindtap="activityClick" data-type="{{item.activity_type}}" data-id="{{item.id}}">{{item.activity_type == 1 ? '抽奖' : '兑换'}}</button>
        </view>
      </view>
    </view>
  </view>


<!-- 遮罩层弹框 -->
  <view wx:if="{{showCover}}" class="cover" catchtouchmove="true">
    <!-- 冻结弹框 -->
    <view wx:if="{{showFreezeBox}}" class="freeze-box">
      <text>您的熊猫币已被冻结，不可使用\n如有问题请联系400-6188-555</text>
    </view>

    <!-- 扫码核销弹框 -->
    <view wx:if="{{showScanBox}}" class="scan-box">
      <view class="scan-title">您的展会现场活动福利</view>
      <canvas class='canvas' disable-scroll="true" canvas-id='qrcode'></canvas>
      <view class="scan-desc">
        <image src="https://img.51jiabo.com/db09f2ba-8af7-4e42-aa5a-faba77715aa2.png"
          style="width: 44rpx;height: 44rpx;margin-right: 15rpx;"></image>
        <view>扫码核销</view>
      </view>
      <view class="scan-line"></view>
      <scroll-view class="scan-list" scroll-y="true">
        <view class="scan-item" wx:for="{{bagListData}}" wx:key="index">
          <view class="scan-item-name">{{item.name}}</view>
          <view wx:if="{{item.activity_type == 1}}" class="scan-item-prize">{{item.award_type == 1 ? '现金' : ''}}{{item.award_name}}</view>
          <view class="scan-item-status">{{item.status}}</view>
        </view>
      </scroll-view>
      <view class="scan-tips">注：展会现场活动福利须在展会现场参加，请及时参与活动哟~~展会结束将不可参与</view>
      <image class="scan-close" src="https://img.51jiabo.com/dbfd480e-dbf3-4217-bf36-c85f773b0d65.png" bindtap="scanClose"></image>
    </view>

    <!-- 中奖弹框 -->
    <view wx:if="{{showPrizePopup}}" class="prize-popup">
      <view class="prize-popup-title">恭喜您抽中{{actPrize.award}}</view>
      <image src="{{actPrize.image_url || 'https://img.51jiabo.com/43ff6300-b920-4e7e-aed9-6aa6238bed27.png'}}" class="prize-popup-img"></image>
      <button class="prize-popup-btn" bindtap="prizePopupClose">知道了</button>
      <view class="prize-popup-tips">领取奖品请点击页面右侧小福袋，凭领取码开展期间到展会现场下单抽奖处领取哟~</view>
    </view>

    <!-- 签到成功 -->
    <view wx:if="{{signInSuccessNum}}" class="sign-in-popup">
      <view class="sign-in-popup-title">签到成功</view>
      <view class="sign-in-popup-cont">恭喜您获得{{signInSuccessNum}}熊猫币</view>
    </view>

    <!-- 签到规则弹框 -->
    <view wx:if="{{showSignInRules}}" class="xmb-rules-popup">
      <view class="xmb-rules-title">签到规则</view>
      <scroll-view scroll-y="true" class="xmb-rules-cont">
        <text>{{signInRulesCont}}</text>
      </scroll-view>
      <button class="xmb-rules-btn" bindtap="signInRulesPopupClose">知道了</button>
    </view>

    <!-- 兑换成功 -->
    <view wx:if="{{showExchangeSuccess}}" class="xmb-rules-popup" style="height: 580rpx;">
      <view class="xmb-rules-title">兑换成功</view>
      <view class="xmb-rules-cont">
        <text>请{{exchangeCont.begin_date}}-{{exchangeCont.end_date}}到{{exchangeCont.venue_name}}展会现场，出示页面右侧小福袋领取码参加{{exchangeCont.activity_name}}哟~</text>
      </view>
      <button class="xmb-rules-btn" bindtap="exchangeSuccessClose">知道了</button>
    </view>

    <!-- 兑换/抽奖失败 -->
    <view wx:if="{{showLotteryFailPopup}}" class="xmb-rules-popup" style="height: 574rpx;">
      <view class="xmb-rules-title">{{isExchange ? '兑换':'抽奖'}}失败</view>
      <view class="xmb-rules-cont" style="text-align: center;">
        <text>{{LotteryFail}}</text>
      </view>
      <button class="xmb-rules-btn" bindtap="lotteryFailPopupClose">知道了</button>
    </view>

    <!-- 活动规则弹框 -->
    <view wx:if="{{showActivityRules}}" class="xmb-rules-popup">
      <view class="xmb-rules-title">活动规则</view>
      <scroll-view scroll-y="true" class="xmb-rules-cont">
        <text>{{siteRulesCont}}</text>
      </scroll-view>
      <button class="xmb-rules-btn" bindtap="activityRulesClose">知道了</button>
    </view>

    <!-- 熊猫币规则弹框 -->
    <view wx:if="{{showXmbRules}}" class="xmb-rules-popup">
      <view class="xmb-rules-title">熊猫币规则</view>
      <scroll-view scroll-y="true" class="xmb-rules-cont">
        <text>{{xmbRulesCont}}</text>
      </scroll-view>
      <button class="xmb-rules-btn" bindtap="xmbRulesPopupClose">知道了</button>
    </view>

    <!-- 熊猫币领取成功弹框 -->
    <view wx:if="{{showReceivePopup}}" class="receive-popup">恭喜您获得{{receiveNum}}熊猫币</view>

    <!-- 逛展任务弹框 -->
    <view wx:if="{{showZhanPopup}}" class="zhan-popup">
      <view>{{showZhanPopupCont}}</view>
      <button class="xmb-rules-btn" bindtap="zhanPopupClose">知道了</button>
    </view>

    <!-- 抽奖loading -->
    <image hidden="{{cjHideLoading}}" class="cj-loading" src="https://img.51jiabo.com/d5897c06-e66f-4cfa-98f4-88811bfdf53f.gif"></image>

  </view>

  <!-- 福袋 -->
  <block>
    <image hidden="{{bagGif}}" bindtap="scanBoxShow" class="bag {{showBag?'show':''}}" src="https://img.51jiabo.com/31db64cd-93c5-4597-9c51-410a61a7e4ba.png"></image>
    <image hidden="{{!bagGif}}" bindtap="scanBoxShow" class="bag {{showBag?'show':''}}" src="https://img.51jiabo.com/63555ac5-081a-4602-aa67-b9237cbab127.gif"></image>
  </block>

  <flyCart current="{{currentXY}}" imageUrl="https://img.51jiabo.com/d5653995-b64a-470d-a9eb-360b19384737.png" wx:if="{{aniStart}}"></flyCart>
</view>